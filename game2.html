<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GAME2</title>
<style>
 body {
  margin: 0;
  overflow: hidden;
  height: 100vh;
  width: 100vw;

  /* まずは確実に色をつける（白防止） */
  background-color: #000;

  /* Safari でも確実に動く書き方 */
  background-image:
    radial-gradient(circle at center, #1a1a1a 0%, #000 100%);

  background-repeat: no-repeat;
  background-size: cover;

  font-family: sans-serif;
  color: white;
}


  /* プレイヤー */
  #player {
    position: absolute;
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #4fc3f7, #0288d1);
    border-radius: 8px;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: 0 0 15px #4fc3f7;
  }

  /* 敵 */
  .enemy {
    position: absolute;
    width: 35px;
    height: 35px;
    background: linear-gradient(135deg, #ff5252, #b71c1c);
    border-radius: 6px;
    box-shadow: 0 0 12px #ff1744;
  }

  /* スコア */
  #score {
    position: absolute;
    top: 15px;
    left: 20px;
    font-size: 26px;
    letter-spacing: 2px;
    text-shadow: 0 0 10px #4fc3f7;
  }

  /* ゲームオーバー */
  #gameover {
    position: absolute;
    top: 35%;
    width: 100%;
    text-align: center;
    font-size: 60px;
    display: none;
    text-shadow: 0 0 20px #ff1744;
  }

  /* ボタン */
  #buttons {
    position: absolute;
    top: 60%;
    width: 100%;
    text-align: center;
    display: none;
  }
  #buttons button {
    font-size: 26px;
    padding: 12px 25px;
    margin: 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #4fc3f7;
    color: #000;
    box-shadow: 0 0 10px #4fc3f7;
  }
  #buttons button:hover {
    background: #81d4fa;
  }

  /* 落下エフェクト */
  @keyframes fallGlow {
    0% { box-shadow: 0 0 5px #ff1744; }
    100% { box-shadow: 0 0 20px #ff1744; }
  }
</style>
</head>
<body>

<div id="player"></div>
<div id="score">SCORE: 0</div>
<div id="gameover"></div>
<div id="buttons">
  <button onclick="location.reload()">リトライ</button>
  <button onclick="location.href='index.html'">タイトルへ</button>
</div>

<script>
const player = document.getElementById("player");
const scoreText = document.getElementById("score");
const gameoverText = document.getElementById("gameover");
const buttons = document.getElementById("buttons");

let px = window.innerWidth / 2 - 20;
let speed = 8;
let score = 0;
let gameOver = false;

let keys = { left: false, right: false };

document.addEventListener("keydown", e => {
  if (e.code === "ArrowLeft") keys.left = true;
  if (e.code === "ArrowRight") keys.right = true;
});
document.addEventListener("keyup", e => {
  if (e.code === "ArrowLeft") keys.left = false;
  if (e.code === "ArrowRight") keys.right = false;
});

document.addEventListener("touchstart", e => {
  const x = e.touches[0].clientX;
  if (x < window.innerWidth / 2) keys.left = true;
  else keys.right = true;
});
document.addEventListener("touchend", () => {
  keys.left = false;
  keys.right = false;
});

function spawnEnemy() {
  if (gameOver) return;

  const e = document.createElement("div");
  e.className = "enemy";
  e.style.left = Math.random() * (window.innerWidth - 35) + "px";
  e.style.top = "-50px";
  e.style.animation = "fallGlow 0.5s infinite alternate";
  document.body.appendChild(e);

  let ey = -50;
  let fallSpeed = 4 + Math.random() * 5 + score * 0.05; // スコアで加速

  function fall() {
    if (gameOver) return;

    ey += fallSpeed;
    e.style.top = ey + "px";

    const ex = parseInt(e.style.left);

    // プレイヤー矩形
    const playerLeft = px;
    const playerRight = px + 45;
    const playerTop = window.innerHeight - 60 - 45;
    const playerBottom = window.innerHeight - 60;

    // 敵矩形
    const enemyLeft = ex;
    const enemyRight = ex + 35;
    const enemyTop = ey;
    const enemyBottom = ey + 35;

    // 正確な衝突判定
    if (
      playerLeft < enemyRight &&
      playerRight > enemyLeft &&
      playerTop < enemyBottom &&
      playerBottom > enemyTop
    ) {
      endGame();
      return;
    }

    if (ey < window.innerHeight) {
      requestAnimationFrame(fall);
    } else {
      e.remove();
      score++;
      scoreText.textContent = "SCORE: " + score;
    }
  }

  fall();

  setTimeout(spawnEnemy, 500 + Math.random() * 300);
}

function loop() {
  if (gameOver) return;

  if (keys.left) px -= speed;
  if (keys.right) px += speed;

  px = Math.max(0, Math.min(window.innerWidth - 45, px));
  player.style.left = px + "px";

  requestAnimationFrame(loop);
}

function endGame() {
  gameOver = true;
  gameoverText.textContent = "GAME OVER\nSCORE: " + score;
  gameoverText.style.display = "block";
  buttons.style.display = "block";
}

spawnEnemy();
loop();
</script>

</body>
</html>
